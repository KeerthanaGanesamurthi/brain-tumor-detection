<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>NeuroScan - Brain Tumor Detection System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- PDF generation library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
      
      :root {
        --primary: #1a73e8;
        --primary-dark: #0d47a1;
        --secondary: #f5f7fa;
        --text-dark: #202124;
        --text-light: #5f6368;
        --white: #ffffff;
        --success: #34a853;
        --warning: #fbbc04;
        --danger: #ea4335;
        --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        --transition: all 0.3s ease;
      }
      
      .dark-mode {
        --primary: #8ab4f8;
        --primary-dark: #aecbfa;
        --secondary: #202124;
        --text-dark: #e8eaed;
        --text-light: #9aa0a6;
        --white: #303134;
        --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      }
      
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      
      body {
        font-family: 'Poppins', sans-serif;
        background-color: var(--secondary);
        color: var(--text-dark);
        transition: var(--transition);
        min-height: 100vh;
      }
      
      .app-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }
      
      /* Header Styles */
      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px 0;
        margin-bottom: 30px;
        border-bottom: 1px solid rgba(0, 0, 0, 0.1);
      }
      
      .logo {
        display: flex;
        align-items: center;
        gap: 12px;
      }
      
      .logo i {
        font-size: 28px;
        color: var(--primary);
      }
      
      .logo h1 {
        font-size: 24px;
        font-weight: 600;
      }
      
      .header-controls {
        display: flex;
        align-items: center;
        gap: 20px;
      }
      
      .theme-toggle {
        background: none;
        border: none;
        cursor: pointer;
        font-size: 20px;
        color: var(--text-dark);
      }
      
      .user-profile {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      
      .avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background-color: var(--primary);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
      }
      
      /* Navigation */
      .nav-tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 30px;
        border-bottom: 1px solid rgba(0, 0, 0, 0.1);
      }
      
      .nav-tab {
        padding: 12px 24px;
        background: none;
        border: none;
        cursor: pointer;
        font-size: 16px;
        font-weight: 500;
        color: var(--text-light);
        border-bottom: 3px solid transparent;
        transition: var(--transition);
      }
      
      .nav-tab.active {
        color: var(--primary);
        border-bottom: 3px solid var(--primary);
      }
      
      /* Page Containers */
      .page-container {
        display: none;
      }
      
      .page-container.active {
        display: block;
      }
      
      /* Card Styles */
      .card {
        background-color: var(--white);
        border-radius: 12px;
        box-shadow: var(--card-shadow);
        padding: 25px;
        margin-bottom: 25px;
        transition: var(--transition);
      }
      
      .card-header {
        margin-bottom: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      
      .card-title {
        font-size: 18px;
        font-weight: 500;
      }
      
      /* Form Styles */
      .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 20px;
      }
      
      .form-group {
        margin-bottom: 20px;
        position: relative;
      }
      
      .form-label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: var(--text-dark);
      }
      
      .form-input {
        width: 100%;
        padding: 12px 15px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 16px;
        transition: var(--transition);
        background-color: var(--white);
        color: var(--text-dark);
      }
      
      .form-input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
      }
      
      /* Button Styles */
      .btn {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 12px 24px;
        background-color: var(--primary);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 500;
        cursor: pointer;
        transition: var(--transition);
        text-decoration: none;
      }
      
      .btn:hover {
        background-color: var(--primary-dark);
      }
      
      .btn-block {
        width: 100%;
        justify-content: center;
      }
      
      /* Upload Styles */
      .upload-container {
        border: 2px dashed #d1d8e0;
        border-radius: 12px;
        padding: 40px;
        text-align: center;
        margin-bottom: 25px;
        transition: var(--transition);
        background-color: #f8f9fa;
      }
      
      .upload-container.highlight {
        border-color: var(--primary);
        background-color: rgba(26, 115, 232, 0.05);
      }
      
      .upload-icon {
        font-size: 50px;
        color: var(--primary);
        margin-bottom: 15px;
      }
      
      .upload-text {
        margin-bottom: 20px;
        color: var(--text-light);
      }
      
      .file-input {
        display: none;
      }
      
      .file-label {
        display: inline-block;
        background-color: var(--primary);
        color: white;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        transition: var(--transition);
        font-weight: 500;
      }
      
      .file-label:hover {
        background-color: var(--primary-dark);
      }
      
      .selected-file {
        margin-top: 15px;
        font-size: 14px;
        color: var(--text-light);
      }
      
      /* Result Styles */
      .result-container {
        margin-top: 30px;
      }
      
      .result-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
      }
      
      @media (max-width: 768px) {
        .result-grid {
          grid-template-columns: 1fr;
        }
      }
      
      .prediction {
        font-size: 22px;
        font-weight: 600;
        margin-bottom: 15px;
        padding: 12px;
        border-radius: 8px;
        text-align: center;
      }
      
      .no-tumor {
        background-color: rgba(52, 168, 83, 0.1);
        color: var(--success);
      }
      
      .tumor {
        background-color: rgba(234, 67, 53, 0.1);
        color: var(--danger);
      }
      
      .image-preview {
        width: 100%;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: var(--card-shadow);
      }
      
      .image-preview img {
        width: 100%;
        height: auto;
        display: block;
      }
      
      .patient-details {
        list-style: none;
      }
      
      .patient-details li {
        padding: 12px 0;
        border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        display: flex;
        justify-content: space-between;
      }
      
      .patient-details li:last-child {
        border-bottom: none;
      }
      
      .detail-label {
        color: var(--text-light);
      }
      
      /* Loading Styles */
      .loading {
        display: none;
        text-align: center;
        margin: 20px 0;
      }
      
      .spinner {
        width: 40px;
        height: 40px;
        border: 4px solid rgba(0, 0, 0, 0.1);
        border-left-color: var(--primary);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 15px;
        display: inline-block;
      }
      
      @keyframes spin {
        to { transform: rotate(360deg); }
      }
      
      /* Patient List Styles */
      .patient-list {
        list-style: none;
        margin-top: 20px;
      }
      
      .patient-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 0;
        border-bottom: 1px solid rgba(0, 0, 0, 0.1);
      }
      
      .patient-info h3 {
        font-size: 16px;
        margin-bottom: 5px;
      }
      
      .patient-info p {
        font-size: 14px;
        color: var(--text-light);
      }
      
      .patient-action {
        color: var(--primary);
        text-decoration: none;
        font-weight: 500;
      }
      
      /* Footer Styles */
      .footer {
        text-align: center;
        margin-top: 50px;
        padding-top: 20px;
        border-top: 1px solid rgba(0, 0, 0, 0.1);
        color: var(--text-light);
        font-size: 14px;
      }
      
      /* Utility Classes */
      .hidden {
        display: none;
      }
      
      .auto-refresh-notice {
        text-align: center;
        margin-top: 20px;
        padding: 15px;
        background-color: rgba(26, 115, 232, 0.1);
        border-radius: 8px;
        color: var(--primary);
      }

      /* Notification Styles */
      .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 20px;
        border-radius: 8px;
        background-color: var(--white);
        box-shadow: var(--card-shadow);
        display: flex;
        align-items: center;
        gap: 10px;
        transform: translateX(150%);
        transition: transform 0.3s ease;
        z-index: 1000;
      }
      
      .notification.show {
        transform: translateX(0);
      }
      
      .notification.success {
        border-left: 4px solid var(--success);
      }
      
      .notification.error {
        border-left: 4px solid var(--danger);
      }
      
      .notification-icon {
        font-size: 20px;
      }
      
      .success .notification-icon {
        color: var(--success);
      }
      
      .error .notification-icon {
        color: var(--danger);
      }

      /* Confidence Meter */
      .confidence-meter {
        height: 10px;
        background-color: #eee;
        border-radius: 5px;
        margin: 10px 0 20px;
        overflow: hidden;
      }
      
      .confidence-fill {
        height: 100%;
        border-radius: 5px;
        transition: width 1s ease-in-out;
      }
      
      .confidence-fill.high {
        background-color: var(--success);
      }
      
      .confidence-fill.medium {
        background-color: var(--warning);
      }
      
      .confidence-fill.low {
        background-color: var(--danger);
      }

      /* PDF Report Styles */
      #pdf-template {
        position: absolute;
        left: -9999px;
        top: -9999px;
        width: 800px;
        padding: 40px;
        background: white;
        color: black;
      }
    </style>
  </head>
  <body>
    <div class="app-container">
      <!-- Header -->
      <div class="header">
        <div class="logo">
          <i class="fas fa-brain"></i>
          <h1>NeuroScan</h1>
        </div>
        <div class="header-controls">
          <button class="theme-toggle" id="themeToggle">
            <i class="fas fa-moon"></i>
          </button>
          <div class="user-profile">
            <div class="avatar">DR</div>
            <span>Dr. Smith</span>
          </div>
        </div>
      </div>
      
      <!-- Navigation Tabs -->
      <div class="nav-tabs">
        <button class="nav-tab active" data-page="dashboard">Dashboard</button>
        <button class="nav-tab" data-page="upload">Upload Scan</button>
        <button class="nav-tab" data-page="results">Results</button>
      </div>
      
      <!-- Dashboard Page -->
      <div class="page-container active" id="dashboard-page">
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Patient Details</h2>
          </div>
          <form id="patientForm">
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">Patient ID</label>
                <input type="text" class="form-input" id="patientId" value="PT-004523" readonly>
              </div>
              <div class="form-group">
                <label class="form-label">Full Name</label>
                <input type="text" class="form-input" id="patientName" required>
              </div>
              <div class="form-group">
                <label class="form-label">Age</label>
                <input type="number" class="form-input" id="patientAge" required min="1" max="120">
              </div>
              <div class="form-group">
                <label class="form-label">Height (cm)</label>
                <input type="number" class="form-input" id="patientHeight" required min="50" max="250">
              </div>
              <div class="form-group">
                <label class="form-label">Weight (kg)</label>
                <input type="number" class="form-input" id="patientWeight" required min="2" max="200">
              </div>
              <div class="form-group">
                <label class="form-label">Blood Pressure</label>
                <input type="text" class="form-input" id="patientBP" placeholder="e.g., 120/80">
              </div>
              <div class="form-group">
                <label class="form-label">Sugar Level (mg/dL)</label>
                <input type="number" class="form-input" id="patientSugar" min="50" max="500">
              </div>
            </div>
            <div class="form-group">
              <label class="form-label">Medical History</label>
              <textarea class="form-input" id="patientHistory" rows="3"></textarea>
            </div>
            <button type="submit" class="btn btn-block">Save Patient Details</button>
          </form>
        </div>
        
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Recent Patients</h2>
          </div>
          <ul class="patient-list" id="patientList">
            <li class="patient-item">
              <div class="patient-info">
                <h3>John Doe</h3>
                <p>ID: PT-000123 • Age: 45 • Last scan: Today</p>
              </div>
              <a href="#" class="patient-action">View</a>
            </li>
            <li class="patient-item">
              <div class="patient-info">
                <h3>Jane Smith</h3>
                <p>ID: PT-000122 • Age: 36 • Last scan: Yesterday</p>
              </div>
              <a href="#" class="patient-action">View</a>
            </li>
            <li class="patient-item">
              <div class="patient-info">
                <h3>Robert Johnson</h3>
                <p>ID: PT-000121 • Age: 62 • Last scan: 2 days ago</p>
              </div>
              <a href="#" class="patient-action">View</a>
            </li>
          </ul>
        </div>
      </div>
      
      <!-- Upload Page -->
      <div class="page-container" id="upload-page">
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Upload MRI Scan</h2>
          </div>
          <form method="POST" enctype="multipart/form-data" id="uploadForm">
            <div class="upload-container" id="uploadArea">
              <div class="upload-icon">
                <i class="fas fa-cloud-upload-alt"></i>
              </div>
              <p class="upload-text">Select a brain MRI scan or drag & drop it here</p>
              <input type="file" name="file" id="fileInput" class="file-input" accept="image/*" required>
              <label for="fileInput" class="file-label">
                <i class="fas fa-file-medical"></i> Choose File
              </label>
              <div class="selected-file" id="selectedFile">No file selected</div>
            </div>
            
            <button type="submit" class="btn btn-block" id="submitBtn">
              <i class="fas fa-search"></i> Analyze MRI Scan
            </button>
          </form>
          
          <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Processing your MRI scan...</p>
          </div>
        </div>
      </div>
      
      <!-- Results Page -->
      <div class="page-container" id="results-page">
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Detection Results</h2>
            <button class="btn" id="downloadReportBtn">
              <i class="fas fa-download"></i> Download Report
            </button>
          </div>
          
          <div class="result-grid">
            <div>
              <div class="image-preview">
                <img src="" alt="Processed MRI Scan" id="resultImage">
              </div>
              
              <div class="prediction no-tumor" id="predictionResult">
                <i class="fas fa-check-circle"></i>
                <span id="predictionText">No Tumor Detected</span>
              </div>
              
              <div id="confidenceContainer">
                <p>Confidence: <span id="confidenceValue">92</span>%</p>
                <div class="confidence-meter">
                  <div class="confidence-fill high" id="confidenceFill" style="width: 92%"></div>
                </div>
              </div>
            </div>
            
            <div>
              <h3 class="card-title">Patient Information</h3>
              <ul class="patient-details">
                <li>
                  <span class="detail-label">Patient ID:</span>
                  <span id="resultPatientId">PT-004523</span>
                </li>
                <li>
                  <span class="detail-label">Name:</span>
                  <span id="resultPatientName">John Doe</span>
                </li>
                <li>
                  <span class="detail-label">Age:</span>
                  <span id="resultPatientAge">45</span>
                </li>
                <li>
                  <span class="detail-label">Height:</span>
                  <span id="resultPatientHeight">175 cm</span>
                </li>
                <li>
                  <span class="detail-label">Weight:</span>
                  <span id="resultPatientWeight">72 kg</span>
                </li>
                <li>
                  <span class="detail-label">Blood Pressure:</span>
                  <span id="resultPatientBP">120/80 mmHg</span>
                </li>
                <li>
                  <span class="detail-label">Sugar Level:</span>
                  <span id="resultPatientSugar">98 mg/dL</span>
                </li>
              </ul>
            </div>
          </div>
          
          <div class="auto-refresh-notice">
            <p>Auto-redirecting to dashboard in <span id="countdown">30</span> seconds for next patient</p>
          </div>
        </div>
      </div>
      
      <div class="footer">
        <p>Cloud-Based Brain Tumor Detection System • Secure Medical Platform</p>
      </div>
    </div>

    <!-- Notification Element -->
    <div class="notification" id="notification">
      <i class="fas fa-check-circle notification-icon"></i>
      <div class="notification-content">
        <h4>Success</h4>
        <p>Patient details saved successfully</p>
      </div>
    </div>

    <!-- PDF Template (hidden) -->
    <div id="pdf-template">
      <h1>Brain Tumor Detection Report</h1>
      <hr>
      <h2>Patient Information</h2>
      <p><strong>Patient ID:</strong> <span id="pdf-patient-id"></span></p>
      <p><strong>Name:</strong> <span id="pdf-patient-name"></span></p>
      <p><strong>Age:</strong> <span id="pdf-patient-age"></span></p>
      <p><strong>Height:</strong> <span id="pdf-patient-height"></span></p>
      <p><strong>Weight:</strong> <span id="pdf-patient-weight"></span></p>
      <p><strong>Blood Pressure:</strong> <span id="pdf-patient-bp"></span></p>
      <p><strong>Sugar Level:</strong> <span id="pdf-patient-sugar"></span></p>
      
      <h2>Scan Results</h2>
      <p><strong>Result:</strong> <span id="pdf-prediction"></span></p>
      <p><strong>Confidence:</strong> <span id="pdf-confidence"></span>%</p>
      
      <div id="pdf-image-container">
        <p><strong>MRI Scan:</strong></p>
        <img id="pdf-scan-image" src="" style="max-width: 300px;">
      </div>
      
      <hr>
      <p><em>Report generated on: <span id="pdf-date"></span></em></p>
      <p><em>This is an automated report generated by NeuroScan Brain Tumor Detection System.</em></p>
    </div>

    <script>
      // Initialize jsPDF
      const { jsPDF } = window.jspdf;
      
      document.addEventListener('DOMContentLoaded', function() {
        // DOM Elements
        const themeToggle = document.getElementById('themeToggle');
        const themeIcon = themeToggle.querySelector('i');
        const navTabs = document.querySelectorAll('.nav-tab');
        const pageContainers = document.querySelectorAll('.page-container');
        const patientForm = document.getElementById('patientForm');
        const uploadForm = document.getElementById('uploadForm');
        const fileInput = document.getElementById('fileInput');
        const selectedFile = document.getElementById('selectedFile');
        const submitBtn = document.getElementById('submitBtn');
        const loading = document.getElementById('loading');
        const uploadArea = document.getElementById('uploadArea');
        const downloadReportBtn = document.getElementById('downloadReportBtn');
        const countdownElement = document.getElementById('countdown');
        const notification = document.getElementById('notification');
        const resultImage = document.getElementById('resultImage');
        const predictionResult = document.getElementById('predictionResult');
        const predictionText = document.getElementById('predictionText');
        const confidenceValue = document.getElementById('confidenceValue');
        const confidenceFill = document.getElementById('confidenceFill');
        
        // Theme toggle functionality
        if (localStorage.getItem('darkMode') === 'enabled') {
          document.body.classList.add('dark-mode');
          themeIcon.classList.remove('fa-moon');
          themeIcon.classList.add('fa-sun');
        }
        
        themeToggle.addEventListener('click', () => {
          document.body.classList.toggle('dark-mode');
          
          if (document.body.classList.contains('dark-mode')) {
            localStorage.setItem('darkMode', 'enabled');
            themeIcon.classList.remove('fa-moon');
            themeIcon.classList.add('fa-sun');
          } else {
            localStorage.setItem('darkMode', 'disabled');
            themeIcon.classList.remove('fa-sun');
            themeIcon.classList.add('fa-moon');
          }
        });
        
        // Navigation functionality
        navTabs.forEach(tab => {
          tab.addEventListener('click', () => {
            const targetPage = tab.getAttribute('data-page');
            
            // Update active tab
            navTabs.forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            
            // Show target page
            pageContainers.forEach(page => {
              page.classList.remove('active');
              if (page.id === `${targetPage}-page`) {
                page.classList.add('active');
              }
            });
          });
        });
        
        // Patient form submission
        patientForm.addEventListener('submit', (e) => {
          e.preventDefault();
          
          // Show notification
          showNotification('Patient details saved successfully', 'success');
          
          // Switch to upload page
          document.querySelector('[data-page="upload"]').click();
        });
        
        // File upload functionality
        fileInput.addEventListener('change', function() {
          if (this.files.length > 0) {
            selectedFile.textContent = this.files[0].name;
            submitBtn.disabled = false;
            
            // Preview image
            const reader = new FileReader();
            reader.onload = function(e) {
              resultImage.src = e.target.result;
            };
            reader.readAsDataURL(this.files[0]);
          } else {
            selectedFile.textContent = 'No file selected';
            submitBtn.disabled = true;
          }
        });
        
        // Drag and drop functionality
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
          uploadArea.addEventListener(eventName, preventDefaults, false);
        });
        
        function preventDefaults(e) {
          e.preventDefault();
          e.stopPropagation();
        }
        
        ['dragenter', 'dragover'].forEach(eventName => {
          uploadArea.addEventListener(eventName, highlight, false);
        });
        
        ['dragleave', 'drop'].forEach(eventName => {
          uploadArea.addEventListener(eventName, unhighlight, false);
        });
        
        function highlight() {
          uploadArea.classList.add('highlight');
        }
        
        function unhighlight() {
          uploadArea.classList.remove('highlight');
        }
        
        uploadArea.addEventListener('drop', handleDrop, false);
        
        function handleDrop(e) {
          const dt = e.dataTransfer;
          const files = dt.files;
          fileInput.files = files;
          
          if (files.length > 0) {
            selectedFile.textContent = files[0].name;
            submitBtn.disabled = false;
            
            // Preview image
            const reader = new FileReader();
            reader.onload = function(e) {
              resultImage.src = e.target.result;
            };
            reader.readAsDataURL(files[0]);
          }
        }
        
        // Form submission - Simulate analysis and redirect to results
        uploadForm.addEventListener('submit', function(e) {
          e.preventDefault();
          
          // Show loading indicator
          loading.style.display = 'block';
          submitBtn.disabled = true;
          
          // Simulate processing delay (in a real app, this would be handled by the backend)
          setTimeout(() => {
            // Get a random prediction for demo purposes
            const predictions = ['Glioma', 'Meningioma', 'No Tumor', 'Pituitary'];
            const randomPrediction = predictions[Math.floor(Math.random() * predictions.length)];
            const randomConfidence = (80 + Math.random() * 20).toFixed(2);
            
            // Update UI with results
            updateResults(randomPrediction, randomConfidence);
            
            // Redirect to results page
            document.querySelector('[data-page="results"]').click();
            
            // Hide loading indicator
            loading.style.display = 'none';
            submitBtn.disabled = false;
            
            // Start auto-refresh countdown
            startCountdown();
          }, 2000);
        });
        
        // Update results function
        function updateResults(prediction, confidence) {
          // Update prediction text and styling
          predictionText.textContent = prediction;
          
          if (prediction === 'No Tumor') {
            predictionResult.className = 'prediction no-tumor';
            predictionResult.innerHTML = '<i class="fas fa-check-circle"></i> ' + prediction;
          } else {
            predictionResult.className = 'prediction tumor';
            predictionResult.innerHTML = '<i class="fas fa-exclamation-triangle"></i> ' + prediction;
          }
          
          // Update confidence
          confidenceValue.textContent = confidence;
          confidenceFill.style.width = confidence + '%';
          
          // Set confidence color
          if (confidence > 75) {
            confidenceFill.className = 'confidence-fill high';
          } else if (confidence > 50) {
            confidenceFill.className = 'confidence-fill medium';
          } else {
            confidenceFill.className = 'confidence-fill low';
          }
          
          // Update patient info in results
          document.getElementById('resultPatientId').textContent = document.getElementById('patientId').value;
          document.getElementById('resultPatientName').textContent = document.getElementById('patientName').value;
          document.getElementById('resultPatientAge').textContent = document.getElementById('patientAge').value;
          document.getElementById('resultPatientHeight').textContent = document.getElementById('patientHeight').value + ' cm';
          document.getElementById('resultPatientWeight').textContent = document.getElementById('patientWeight').value + ' kg';
          document.getElementById('resultPatientBP').textContent = document.getElementById('patientBP').value;
          document.getElementById('resultPatientSugar').textContent = document.getElementById('patientSugar').value + ' mg/dL';
        }
        
        // Download report functionality
        downloadReportBtn.addEventListener('click', generatePDFReport);
        
        // Generate PDF report
        function generatePDFReport() {
          // Show loading on button
          const originalText = downloadReportBtn.innerHTML;
          downloadReportBtn.innerHTML = '<div class="spinner" style="width: 20px; height: 20px; border-width: 2px;"></div> Generating...';
          downloadReportBtn.disabled = true;
          
          // Populate PDF template
          document.getElementById('pdf-patient-id').textContent = document.getElementById('resultPatientId').textContent;
          document.getElementById('pdf-patient-name').textContent = document.getElementById('resultPatientName').textContent;
          document.getElementById('pdf-patient-age').textContent = document.getElementById('resultPatientAge').textContent;
          document.getElementById('pdf-patient-height').textContent = document.getElementById('resultPatientHeight').textContent;
          document.getElementById('pdf-patient-weight').textContent = document.getElementById('resultPatientWeight').textContent;
          document.getElementById('pdf-patient-bp').textContent = document.getElementById('resultPatientBP').textContent;
          document.getElementById('pdf-patient-sugar').textContent = document.getElementById('resultPatientSugar').textContent;
          document.getElementById('pdf-prediction').textContent = predictionText.textContent;
          document.getElementById('pdf-confidence').textContent = confidenceValue.textContent;
          document.getElementById('pdf-scan-image').src = resultImage.src;
          document.getElementById('pdf-date').textContent = new Date().toLocaleString();
          
          // Use html2canvas to capture the PDF template
          setTimeout(() => {
            html2canvas(document.getElementById('pdf-template')).then(canvas => {
              const imgData = canvas.toDataURL('image/png');
              const pdf = new jsPDF('p', 'mm', 'a4');
              const imgWidth = 190; // A4 width in mm
              const pageHeight = 295; // A4 height in mm
              const imgHeight = canvas.height * imgWidth / canvas.width;
              let heightLeft = imgHeight;
              let position = 10;
              
              pdf.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
              heightLeft -= pageHeight;
              
              // Add more pages if needed
              while (heightLeft >= 0) {
                position = heightLeft - imgHeight;
                pdf.addPage();
                pdf.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
              }
              
              // Download the PDF
              pdf.save('brain_scan_report_' + document.getElementById('resultPatientId').textContent + '.pdf');
              
              // Restore button
              downloadReportBtn.innerHTML = originalText;
              downloadReportBtn.disabled = false;
              
              showNotification('Report downloaded successfully', 'success');
            });
          }, 500);
        }
        
        // Auto-refresh countdown
        function startCountdown() {
          let timeLeft = 30;
          countdownElement.textContent = timeLeft;
          
          const countdownInterval = setInterval(() => {
            timeLeft--;
            countdownElement.textContent = timeLeft;
            
            if (timeLeft <= 0) {
              clearInterval(countdownInterval);
              // Reset forms and return to dashboard
              patientForm.reset();
              uploadForm.reset();
              selectedFile.textContent = 'No file selected';
              document.querySelector('[data-page="dashboard"]').click();
              // Generate new patient ID
              document.getElementById('patientId').value = 'PT-' + Math.random().toString().substr(2, 6);
            }
          }, 1000);
        }
        
        // Show notification function
        function showNotification(message, type) {
          const notification = document.getElementById('notification');
          const icon = notification.querySelector('.notification-icon');
          const content = notification.querySelector('.notification-content p');
          
          content.textContent = message;
          notification.className = 'notification ' + type;
          
          if (type === 'success') {
            icon.className = 'notification-icon fas fa-check-circle';
          } else {
            icon.className = 'notification-icon fas fa-exclamation-triangle';
          }
          
          notification.classList.add('show');
          
          // Hide notification after 3 seconds
          setTimeout(() => {
            notification.classList.remove('show');
          }, 3000);
        }
        
        // Initialize with a random patient ID
        document.getElementById('patientId').value = 'PT-' + Math.random().toString().substr(2, 6);
        
        // Enable submit button only if file is selected
        submitBtn.disabled = true;
      });
    </script>
  </body>
</html>